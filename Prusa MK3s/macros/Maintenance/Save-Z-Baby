; 0:/macros/Save-Z
; This macro subtracts the current babystep offset to the Z trigger height and lets the user
; know what to change the G31 command in 0:/sys/config.g to. If you are using multiple filament settings,
; and this is for a specific filament type, recommend placing this yielded information in the filament's config.g.
	 
if move.axes[2].babystep !=0                                   ; If no babysteps are currently adjusted - exit routine
	echo {"OLD: " ^ sensors.probes[0].triggerHeight ^ " NEW: " ^ sensors.probes[0].triggerHeight - move.axes[2].babystep}
	echo {"Edit the G31 command in your config.g to the new Z offset as: G31 Z" ^ sensors.probes[0].triggerHeight - move.axes[2].babystep}

M291 P{"Set probe offset to " ^ sensors.probes[0].triggerHeight - move.axes[2].babystep ^ ", clear babysteps, and REHOME Z?"} R"!WARNING! Do not proceed if printing!" S3
G31 Z{sensors.probes[0].triggerHeight - move.axes[2].babystep} ; set G31 Z offset to corrected
M500 P10:31                                                    ; save settings to config-overide.g - G31 P31 saves trigger height
M290 R0 S0                                                     ; set babystep to 0mm absolute
G28                                                            ; home all

M291 P"Ensure M501 exists in 0:/sys/config, or manually edit the G31 Z setting, to make this change permanent." R"Note on making change permanent." S3 
else
	echo "Baby stepping is not currently active, nothing to do."